<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue2实战总结 | 走不完的独木桥</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="">
    <meta name="keyword" content="前端，笔记，走不完的独木桥，zbw">
    <meta name="author" content="zbw">
    
    <link rel="preload" href="/assets/css/0.styles.086c3bbe.css" as="style"><link rel="preload" href="/assets/js/app.2fd69221.js" as="script"><link rel="preload" href="/assets/js/2.c8687347.js" as="script"><link rel="preload" href="/assets/js/82.29f30e7f.js" as="script"><link rel="prefetch" href="/assets/js/10.0a6d1513.js"><link rel="prefetch" href="/assets/js/100.88ab4f33.js"><link rel="prefetch" href="/assets/js/101.a7145a26.js"><link rel="prefetch" href="/assets/js/102.cc782542.js"><link rel="prefetch" href="/assets/js/11.31ee87c9.js"><link rel="prefetch" href="/assets/js/12.26e76308.js"><link rel="prefetch" href="/assets/js/13.60adb3a1.js"><link rel="prefetch" href="/assets/js/14.aae6515a.js"><link rel="prefetch" href="/assets/js/15.fbb6c346.js"><link rel="prefetch" href="/assets/js/16.886b3270.js"><link rel="prefetch" href="/assets/js/17.11f72f05.js"><link rel="prefetch" href="/assets/js/18.4c867756.js"><link rel="prefetch" href="/assets/js/19.2f34ae88.js"><link rel="prefetch" href="/assets/js/20.56757e39.js"><link rel="prefetch" href="/assets/js/21.2ba59bc6.js"><link rel="prefetch" href="/assets/js/22.cc67e65b.js"><link rel="prefetch" href="/assets/js/23.577ec706.js"><link rel="prefetch" href="/assets/js/24.c6441ab6.js"><link rel="prefetch" href="/assets/js/25.eff16abc.js"><link rel="prefetch" href="/assets/js/26.534b72b6.js"><link rel="prefetch" href="/assets/js/27.979d7675.js"><link rel="prefetch" href="/assets/js/28.b109d1d6.js"><link rel="prefetch" href="/assets/js/29.b7031a81.js"><link rel="prefetch" href="/assets/js/3.b390b88e.js"><link rel="prefetch" href="/assets/js/30.cdcc2549.js"><link rel="prefetch" href="/assets/js/31.27237d4a.js"><link rel="prefetch" href="/assets/js/32.c1105f6c.js"><link rel="prefetch" href="/assets/js/33.a5e761f5.js"><link rel="prefetch" href="/assets/js/34.b655b340.js"><link rel="prefetch" href="/assets/js/35.322eee2b.js"><link rel="prefetch" href="/assets/js/36.894007d3.js"><link rel="prefetch" href="/assets/js/37.14f0f34e.js"><link rel="prefetch" href="/assets/js/38.c6f65776.js"><link rel="prefetch" href="/assets/js/39.3005276a.js"><link rel="prefetch" href="/assets/js/4.effdd555.js"><link rel="prefetch" href="/assets/js/40.3fb95f80.js"><link rel="prefetch" href="/assets/js/41.41316344.js"><link rel="prefetch" href="/assets/js/42.dc50ea3c.js"><link rel="prefetch" href="/assets/js/43.6a60a50c.js"><link rel="prefetch" href="/assets/js/44.5ab33295.js"><link rel="prefetch" href="/assets/js/45.1fabd84e.js"><link rel="prefetch" href="/assets/js/46.6e4c52df.js"><link rel="prefetch" href="/assets/js/47.99ee9c3d.js"><link rel="prefetch" href="/assets/js/48.a0b8a5fc.js"><link rel="prefetch" href="/assets/js/49.999e5667.js"><link rel="prefetch" href="/assets/js/5.6f537172.js"><link rel="prefetch" href="/assets/js/50.fbbbd6a7.js"><link rel="prefetch" href="/assets/js/51.33a4569d.js"><link rel="prefetch" href="/assets/js/52.f3a03c7b.js"><link rel="prefetch" href="/assets/js/53.e69528b2.js"><link rel="prefetch" href="/assets/js/54.51efc700.js"><link rel="prefetch" href="/assets/js/55.5af734dc.js"><link rel="prefetch" href="/assets/js/56.30c2bd12.js"><link rel="prefetch" href="/assets/js/57.33297ccf.js"><link rel="prefetch" href="/assets/js/58.3e138383.js"><link rel="prefetch" href="/assets/js/59.5c6e3ff4.js"><link rel="prefetch" href="/assets/js/6.91d9df77.js"><link rel="prefetch" href="/assets/js/60.3dc7acc2.js"><link rel="prefetch" href="/assets/js/61.84325ecc.js"><link rel="prefetch" href="/assets/js/62.0cc3341a.js"><link rel="prefetch" href="/assets/js/63.8501fe03.js"><link rel="prefetch" href="/assets/js/64.ead31a44.js"><link rel="prefetch" href="/assets/js/65.1ba135f8.js"><link rel="prefetch" href="/assets/js/66.9b488819.js"><link rel="prefetch" href="/assets/js/67.e98f3437.js"><link rel="prefetch" href="/assets/js/68.318c6c22.js"><link rel="prefetch" href="/assets/js/69.268491dc.js"><link rel="prefetch" href="/assets/js/7.b7f07291.js"><link rel="prefetch" href="/assets/js/70.3e636659.js"><link rel="prefetch" href="/assets/js/71.e167de4f.js"><link rel="prefetch" href="/assets/js/72.b543b8c8.js"><link rel="prefetch" href="/assets/js/73.9d16024c.js"><link rel="prefetch" href="/assets/js/74.cbd90b74.js"><link rel="prefetch" href="/assets/js/75.068a9885.js"><link rel="prefetch" href="/assets/js/76.9cab3112.js"><link rel="prefetch" href="/assets/js/77.4bda8875.js"><link rel="prefetch" href="/assets/js/78.ec16a432.js"><link rel="prefetch" href="/assets/js/79.fa9ebda3.js"><link rel="prefetch" href="/assets/js/8.46b09777.js"><link rel="prefetch" href="/assets/js/80.1f9bbeef.js"><link rel="prefetch" href="/assets/js/81.10e48a00.js"><link rel="prefetch" href="/assets/js/83.a31b8fc0.js"><link rel="prefetch" href="/assets/js/84.24d7e54f.js"><link rel="prefetch" href="/assets/js/85.0bf7958a.js"><link rel="prefetch" href="/assets/js/86.e95e433d.js"><link rel="prefetch" href="/assets/js/87.995e792b.js"><link rel="prefetch" href="/assets/js/88.b3fea108.js"><link rel="prefetch" href="/assets/js/89.f5880e17.js"><link rel="prefetch" href="/assets/js/9.efe42fe3.js"><link rel="prefetch" href="/assets/js/90.e7ab7970.js"><link rel="prefetch" href="/assets/js/91.c144e9ca.js"><link rel="prefetch" href="/assets/js/92.11ecee7a.js"><link rel="prefetch" href="/assets/js/93.fb488f44.js"><link rel="prefetch" href="/assets/js/94.dba39697.js"><link rel="prefetch" href="/assets/js/95.29a0fc11.js"><link rel="prefetch" href="/assets/js/96.deae8079.js"><link rel="prefetch" href="/assets/js/97.9ed3c330.js"><link rel="prefetch" href="/assets/js/98.1aa45f8f.js"><link rel="prefetch" href="/assets/js/99.ed001c0f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.086c3bbe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">走不完的独木桥</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/前言/" class="nav-link">
  前言
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作" class="dropdown-title"><span class="title">工作</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作" class="mobile-dropdown-title"><span class="title">工作</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/javascript/" class="nav-link">
  javascript
</a></li><li class="dropdown-subitem"><a href="/frontend/react/" class="nav-link">
  react
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link router-link-active">
  vue
</a></li><li class="dropdown-subitem"><a href="/frontend/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-subitem"><a href="/frontend/css/" class="nav-link">
  css
</a></li><li class="dropdown-subitem"><a href="/frontend/typescript/" class="nav-link">
  typescript
</a></li><li class="dropdown-subitem"><a href="/frontend/utils/" class="nav-link">
  util
</a></li><li class="dropdown-subitem"><a href="/frontend/performance/" class="nav-link">
  性能优化
</a></li><li class="dropdown-subitem"><a href="/frontend/solution/" class="nav-link">
  企业解决方案
</a></li><li class="dropdown-subitem"><a href="/frontend/standard/" class="nav-link">
  团队规范
</a></li><li class="dropdown-subitem"><a href="/frontend/jest/" class="nav-link">
  单元测试
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/node/" class="nav-link">
  node
</a></li></ul></li><li class="dropdown-item"><h4>
          通用
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/http/" class="nav-link">
  http
</a></li><li class="dropdown-subitem"><a href="/frontend/data-structures-algorithms/" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-subitem"><a href="/frontend/design/" class="nav-link">
  设计模式
</a></li></ul></li><li class="dropdown-item"><h4>
          工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/git/" class="nav-link">
  git
</a></li><li class="dropdown-subitem"><a href="/tools/github/" class="nav-link">
  github
</a></li><li class="dropdown-subitem"><a href="/tools/gitlab/" class="nav-link">
  gitlab
</a></li><li class="dropdown-subitem"><a href="/tools/webstorm/" class="nav-link">
  webstorm
</a></li><li class="dropdown-subitem"><a href="/tools/chrome/" class="nav-link">
  chrome
</a></li><li class="dropdown-subitem"><a href="/tools/vscode/" class="nav-link">
  vscode
</a></li><li class="dropdown-subitem"><a href="/tools/charles/" class="nav-link">
  charles
</a></li><li class="dropdown-subitem"><a href="/tools/mac/" class="nav-link">
  mac
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/more/interview/" class="nav-link">
  面试题
</a></li><li class="dropdown-subitem"><a href="/more/hodgepodge/" class="nav-link">
  杂物室
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生活" class="dropdown-title"><span class="title">生活</span> <span class="arrow down"></span></button> <button type="button" aria-label="生活" class="mobile-dropdown-title"><span class="title">生活</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/生活/随笔/" class="nav-link">
  随笔
</a></li></ul></div></div> <a href="https://github.com/topseczbw/single-bridge" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/前言/" class="nav-link">
  前言
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作" class="dropdown-title"><span class="title">工作</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作" class="mobile-dropdown-title"><span class="title">工作</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/javascript/" class="nav-link">
  javascript
</a></li><li class="dropdown-subitem"><a href="/frontend/react/" class="nav-link">
  react
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link router-link-active">
  vue
</a></li><li class="dropdown-subitem"><a href="/frontend/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-subitem"><a href="/frontend/css/" class="nav-link">
  css
</a></li><li class="dropdown-subitem"><a href="/frontend/typescript/" class="nav-link">
  typescript
</a></li><li class="dropdown-subitem"><a href="/frontend/utils/" class="nav-link">
  util
</a></li><li class="dropdown-subitem"><a href="/frontend/performance/" class="nav-link">
  性能优化
</a></li><li class="dropdown-subitem"><a href="/frontend/solution/" class="nav-link">
  企业解决方案
</a></li><li class="dropdown-subitem"><a href="/frontend/standard/" class="nav-link">
  团队规范
</a></li><li class="dropdown-subitem"><a href="/frontend/jest/" class="nav-link">
  单元测试
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/node/" class="nav-link">
  node
</a></li></ul></li><li class="dropdown-item"><h4>
          通用
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/http/" class="nav-link">
  http
</a></li><li class="dropdown-subitem"><a href="/frontend/data-structures-algorithms/" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-subitem"><a href="/frontend/design/" class="nav-link">
  设计模式
</a></li></ul></li><li class="dropdown-item"><h4>
          工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/git/" class="nav-link">
  git
</a></li><li class="dropdown-subitem"><a href="/tools/github/" class="nav-link">
  github
</a></li><li class="dropdown-subitem"><a href="/tools/gitlab/" class="nav-link">
  gitlab
</a></li><li class="dropdown-subitem"><a href="/tools/webstorm/" class="nav-link">
  webstorm
</a></li><li class="dropdown-subitem"><a href="/tools/chrome/" class="nav-link">
  chrome
</a></li><li class="dropdown-subitem"><a href="/tools/vscode/" class="nav-link">
  vscode
</a></li><li class="dropdown-subitem"><a href="/tools/charles/" class="nav-link">
  charles
</a></li><li class="dropdown-subitem"><a href="/tools/mac/" class="nav-link">
  mac
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/more/interview/" class="nav-link">
  面试题
</a></li><li class="dropdown-subitem"><a href="/more/hodgepodge/" class="nav-link">
  杂物室
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生活" class="dropdown-title"><span class="title">生活</span> <span class="arrow down"></span></button> <button type="button" aria-label="生活" class="mobile-dropdown-title"><span class="title">生活</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/生活/随笔/" class="nav-link">
  随笔
</a></li></ul></div></div> <a href="https://github.com/topseczbw/single-bridge" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>VUE</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/vue/" aria-current="page" class="sidebar-link">Vue</a></li><li><a href="/frontend/vue/vue-router-source.html" class="sidebar-link">vue-router 源码学习</a></li><li><a href="/frontend/vue/vue2-menu-control.html" class="sidebar-link">vue2菜单权限控制</a></li><li><a href="/frontend/vue/vue2-skill.html" aria-current="page" class="active sidebar-link">vue2实战总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/vue/vue2-skill.html#provide-与-inject" class="sidebar-link">provide 与 inject</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue2-skill.html#动态组件" class="sidebar-link">动态组件</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue2-skill.html#watch" class="sidebar-link">watch</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue2-skill.html#关于控制组件状态" class="sidebar-link">关于控制组件状态</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue2-skill.html#vue指令使用" class="sidebar-link">vue指令使用</a></li></ul></li><li><a href="/frontend/vue/vue2-source.html" class="sidebar-link">vue2源码学习</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="provide-与-inject"><a href="#provide-与-inject" class="header-anchor">#</a> provide 与 inject</h2> <h3 id="是什么"><a href="#是什么" class="header-anchor">#</a> 是什么？</h3> <p>是一种依赖注入的概念，由父级或祖先级向子级注入数据，子级接收，实现跨越无数层级组件间通讯。</p> <h3 id="为什么存在"><a href="#为什么存在" class="header-anchor">#</a> 为什么存在？</h3> <p>为了解决跨层级组件通讯困难问题诞生。</p> <h3 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h3> <p>注入的数据并不是可响应的，这是刻意为之的，并且不能修改，会报错：避免直接改变注入的值（基本数据类型和引用数据类型的地址），因为只要提供的组件重新呈现，更改就会被覆盖。</p> <p>但是！ <code>如果你传入了一个可监听的对象，那么其对象的属性还是可响应的。</code></p> <p>也就是说引用数据类型的属性是可以改变的，并且可以出发响应式变化，利用这一点，我们可以做很多事情。如利用入口模块向下注入核心数据对象，各子模块接收后粒度化拆分功能修改核心数据对象。</p> <p><code>prop</code> 同理，<code>vue</code> 虽然宣扬单向数据流，但是这种类似于 <code>Angular</code> 数据双向绑定概念的操作，拆分核心对象数据到各个粒度化子组件修改，会让你的代码撸到爽到飞起。</p> <h3 id="在哪里可以使用"><a href="#在哪里可以使用" class="header-anchor">#</a> 在哪里可以使用？</h3> <p>父级组件和子级组件产生了一种隐形的耦合关系，父级不知道最终将数据传给谁，子级不知道数据是从哪里获取到的，因此只建议在封闭度高的高阶组件和组件库中使用，不建议在应用代码中使用。</p> <p>由于传入的基本类型数据不可响应，更推荐注入对象的形式。常用于初始化项目（组件）使用的配置，比如年部学科，这些东西一般不会发生变化，子组件又不定时需要。最重要的是，不依赖于vuex，因此成为开发独立插件组件的首选。</p> <h3 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 父级、祖先级组件</span>
<span class="token function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
    List<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>List<span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 子组件</span>
inject<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 类型</span>
    type<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 列表</span>
    list<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="动态组件"><a href="#动态组件" class="header-anchor">#</a> 动态组件</h2> <h3 id="是什么-2"><a href="#是什么-2" class="header-anchor">#</a> 是什么？</h3> <p>在某个位置，动态切换，加载不同的组件。</p> <h3 id="为什么存在-2"><a href="#为什么存在-2" class="header-anchor">#</a> 为什么存在？</h3> <p>避免出现大量的 <code>v-if</code> , 更优雅处理业务逻辑。</p> <h3 id="注意-2"><a href="#注意-2" class="header-anchor">#</a> 注意</h3> <p>使用动态组件时，通常会重新创建不同的组件，但是当切换的是同一个组件的时候，如单选题组件和多选题组件，由于公用的是一个组件，vue内部会自动处理，不会再重新创建这个组件，不重新创建组件内的状态就无法清空，引发问题，此时需要加一个key作为唯一标识，保证组件重新创建。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">COMPONENT_CONFIG</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token constant">QS_LOGIC_ID_MAP</span><span class="token punctuation">.</span><span class="token constant">SINGLE_CHOICE</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'Choice'</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">QS_LOGIC_ID_MAP</span><span class="token punctuation">.</span><span class="token constant">MULTIPLE_CHOICE</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'Choice'</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">QS_LOGIC_ID_MAP</span><span class="token punctuation">.</span><span class="token constant">FILL_BLANKS</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'FillBlank'</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">QS_LOGIC_ID_MAP</span><span class="token punctuation">.</span><span class="token constant">RESOLVE_ANSWER</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'ResolveQs'</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">QS_LOGIC_ID_MAP</span><span class="token punctuation">.</span><span class="token constant">COMPLEX</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'Complex'</span>
<span class="token punctuation">}</span>
computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当前逻辑题型</span>
    <span class="token function">currentLogicId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mainData<span class="token punctuation">.</span>logicQuesTypeId
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 当前组件</span>
    <span class="token function">currentComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token constant">COMPONENT_CONFIG</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentLogicId<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">&lt;</span>component <span class="token operator">:</span>is<span class="token operator">=</span><span class="token string">&quot;currentComponent&quot;</span> <span class="token operator">:</span>main<span class="token operator">-</span>data<span class="token operator">=</span><span class="token string">&quot;mainData&quot;</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;currentLogicId&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>component<span class="token operator">&gt;</span>
</code></pre></div><h3 id="在哪里可以使用-2"><a href="#在哪里可以使用-2" class="header-anchor">#</a> 在哪里可以使用？</h3> <p>如根据不同的题型id，切换不同的录题组件。</p> <h3 id="示例-2"><a href="#示例-2" class="header-anchor">#</a> 示例</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// currentComponent 是已注册组件的名字 或 一个组件的选项对象</span>
<span class="token operator">&lt;</span>component <span class="token operator">:</span>is<span class="token operator">=</span><span class="token string">&quot;currentComponent&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>component<span class="token operator">&gt;</span>
</code></pre></div><h2 id="watch"><a href="#watch" class="header-anchor">#</a> watch</h2> <h3 id="immediate"><a href="#immediate" class="header-anchor">#</a> immediate</h3> <h4 id="是什么-3"><a href="#是什么-3" class="header-anchor">#</a> 是什么？</h4> <p>让所监听数据初次赋值时就触发 <code>handler</code> ，而非纯异步监听：只有改变时才出发 <code>handler</code></p> <h4 id="为什么存在-3"><a href="#为什么存在-3" class="header-anchor">#</a> 为什么存在？</h4> <p>在一些特定的应用场景中，我们试图监听 <code>prop</code> ，而不仅仅是本组件中的状态，但父组件对子组件 <code>prop</code> 的初次赋值我们是监听不到的，所以 <code>immediate</code> 诞生了。</p> <h4 id="在哪里可以使用-3"><a href="#在哪里可以使用-3" class="header-anchor">#</a> 在哪里可以使用？</h4> <p>监听 <code>prop</code></p> <h4 id="示例-3"><a href="#示例-3" class="header-anchor">#</a> 示例</h4> <div class="language-js extra-class"><pre class="language-js"><code>props<span class="token operator">:</span> <span class="token punctuation">{</span>
    mainData<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Object
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
watch<span class="token operator">:</span> <span class="token punctuation">{</span>
    mainData<span class="token operator">:</span> <span class="token punctuation">{</span>
    deep<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 保证父组件初始化是对mainData（null）赋值后，子组件立即响应</span>
        immediate<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function-variable function">handler</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'update'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mainData<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="关于控制组件状态"><a href="#关于控制组件状态" class="header-anchor">#</a> 关于控制组件状态</h2> <h3 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h3> <p>我们经常说<strong>粒度化</strong>，指将<strong>复杂的功能拆解到不同子模块处理。</strong></p> <p>经过使用vue了一段时间后，我们发现，由于父组件prop传进来的<strong>值/引用地址</strong>在<strong>无法在子组件中直接改变</strong>，于是我们会经常使用prop去初始化子组件中的状态/data，然后去<strong>随心所欲</strong>操作这份数据。</p> <p>有<strong>两种方式</strong>，可以实现以上目标，一是直接在data中使用prop赋予默认值，二是在created钩子中，有一个初始化状态方法 <code>initStatus(slefData)</code> 。</p> <p>我<strong>更推荐后者</strong>，因为也许有一天我们会遇到<strong>父组件需要重置子组件内部状态</strong>的场景，比如<strong>换一题</strong>这样的功能。</p> <p><strong>换一题功能的两种解决方案</strong></p> <ol><li>深度监听试题数据，试题数据发生变化后，重新调用子组件内的 <code>iniSelfData</code> 方法，自己刷新自己。但实际上这是消耗性能，并且不合理的操作。</li> <li>考虑到<strong>性能****，我们既不希望一个庞大的组件</strong>重新创建**，又不想要<strong>上一题留下的冗余的状态</strong>。那么此时我们就可以拿到子组件实例，在获取到下一题数据后，用新的核心数据，去重新调用子组件内部 <code>initSatus(slefData)</code> 方法，达到<strong>优雅更新子组件状态</strong>的目的。这种操作子组件对外提供一个<strong>接口</strong> 即 <code>initStatus</code> 方法，<strong>将重置组件状态的控制权交给父组件</strong>，这样的设计更加<strong>合情合理</strong>。</li></ol> <h3 id="注意-3"><a href="#注意-3" class="header-anchor">#</a> 注意</h3> <p>我知道很多时候我们需要在 <code>created</code> 钩子函数中异步调接口获取数据初始化。</p> <p>但是<strong>千万不要</strong>写出 <code>async created(){}</code> 这样的钩子函数，因为它会将整<strong>个创建函数变成异步函数</strong>。</p> <p>随之带来的是内部的 <code>initStatus(slefData)</code> 函数也变成了异步，但实际上我们需要的是同步。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 不好的写法</span>
<span class="token keyword">async</span> <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 初始化组件内部，一些由用户操作而改变的状态</span>
    <span class="token function">initStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 初始化数据</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requestFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">handlerData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 好的写法</span>
<span class="token keyword">async</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">requestFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 初始化组件内部，一些由用户操作而改变的状态</span>
    <span class="token function">initStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 初始化数据</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">handlerData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="vue指令使用"><a href="#vue指令使用" class="header-anchor">#</a> vue指令使用</h2> <p>使用vue两年了，指令用的非常少。</p> <p>反思了一下原因，使用指令拼的是原生js功底，mvvm流行让开发者手动操作dom的次数越来也少。</p> <p>这次特地啃一下这块的知识点，同时警示自己红宝书该翻一翻了。</p> <h3 id="什么是指令"><a href="#什么是指令" class="header-anchor">#</a> 什么是指令</h3> <blockquote><p>指令是带有 v- 前缀的特殊属性，指令属性的值预期是单个JavaScript表达式。<br></p></blockquote> <h3 id="指令产生的原因"><a href="#指令产生的原因" class="header-anchor">#</a> 指令产生的原因</h3> <blockquote><p>指令的职责是，当表达式的值改变时，将其产生的连带影响，响应式地作用于dom。</p></blockquote> <p>指令的使命是用来操作dom，开发vue应用时，每当有dom操作，应该首先想到使用指令。</p> <p>封装指令也是为了在遇到相同dom操作时，用简单的方式复用。</p> <h3 id="有哪些应用场景"><a href="#有哪些应用场景" class="header-anchor">#</a> 有哪些应用场景</h3> <ul><li>场景1：click-outside场景，当点击非指定元素外的其他元素时，指定关闭/收起下拉框，遮罩的操作</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-click-outside</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>closeFn<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'ClickOutside'</span><span class="token punctuation">,</span>
    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">function</span> <span class="token function">documentHandler</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>binding<span class="token punctuation">.</span>expression<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          binding<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      el<span class="token punctuation">.</span>__vueClickOutside__ <span class="token operator">=</span> documentHandler
      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> documentHandler<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">unbind</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>__vueClickOutside__<span class="token punctuation">)</span>
      <span class="token keyword">delete</span> el<span class="token punctuation">.</span>__vueClickOutside__
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li><p>场景2：如在钉钉端应用中，点击图片元素，实现全屏查看。</p> <p>我们可以给放置图片的容器元素绑定指令 <code>&lt;div class=&quot;box&quot; v-ImgPreviewDirective&gt;</code>，由于点击事件会冒泡到父级元素，所以在指令具体实现中，监听父级元素（指定绑定元素）的点击事件，判断 <code>target</code> 是否是图片元素，如果是则触发执行器函数。</p> <p>执行器函数中使用适配器模式，判断当前执行的环境是钉钉还是pc端，执行不同的处理逻辑</p> <p>这样一来，就将全屏显示图片操作的所有细节逻辑都封装在了一个指令中，轻松地实现复用。</p></li></ul> <h3 id="个人理解"><a href="#个人理解" class="header-anchor">#</a> 个人理解</h3> <h4 id="参数"><a href="#参数" class="header-anchor">#</a> 参数</h4> <blockquote><p>除了 el 之外，其它参数都应该是只读的，切勿进行修改。如果需要在钩子之间共享数据，建议通过元素的 dataset 来进行。</p></blockquote> <p>既然为了操作dom，在指令中一定可以获取到dom元素、参数（常指dom属性）、修饰符、绑定值（用户自定义参数）</p> <div class="language-js extra-class"><pre class="language-js"><code>el<span class="token operator">:</span> 即指定绑定的dom元素

binding<span class="token operator">:</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> 指令名称
  value<span class="token operator">:</span> 传入的用户自定义参数
  arg<span class="token operator">:</span> 如v<span class="token operator">-</span>bind<span class="token operator">:</span>href 中的href 指相关联的dom属性
  modifiers<span class="token operator">:</span> 修饰符相关
<span class="token punctuation">}</span>

vNode：指定所在的vue组件的虚拟节点，通过vNode的context属性可以获取到指令所在的vue实例
</code></pre></div><p>一般操作指令时，希望传入更多的用户自定义参数</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-demo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ color: <span class="token punctuation">'</span>white<span class="token punctuation">'</span>, text: <span class="token punctuation">'</span>hello!<span class="token punctuation">'</span> }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如上，即可通过 <code>binding.value.color</code> 获取到较多的参数</p> <h4 id="动态参数"><a href="#动态参数" class="header-anchor">#</a> 动态参数</h4> <p>很少用到，如 <code>v-style:[attr]=&quot;200&quot;</code> 对于传入的指令的参数（dom属性）不固定，可能是高，也可能是宽的时候</p> <h4 id="钩子函数"><a href="#钩子函数" class="header-anchor">#</a> 钩子函数</h4> <p>bind: 只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置</p> <p>inserted： 被绑定元素插入父节点时调用（仅保证父节点存在，但不一定插入文当中），至此可以获取到el对象</p> <p>update: <code>所在组件的vNode更新时调用, 但是可能发生在其子 VNode 更新之前。</code> 注意！即当视图改变，钩子就会被调用，这个钩子一般情况下会被多次调用</p> <p>componentUpdated: 指令所在组件的 VNode 及其子 VNode 全部更新后调用。</p> <p>unbind: 只调用一次，指令与元素解绑时调用。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/topseczbw/single-bridge/edit/main/docs/frontend/vue/vue2-skill.md" target="_blank" rel="noopener noreferrer">帮助改善此页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021年4月22日星期四凌晨2点12分</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend/vue/vue2-menu-control.html" class="prev">
        vue2菜单权限控制
      </a></span> <span class="next"><a href="/frontend/vue/vue2-source.html">
        vue2源码学习
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.2fd69221.js" defer></script><script src="/assets/js/2.c8687347.js" defer></script><script src="/assets/js/82.29f30e7f.js" defer></script>
  </body>
</html>
